<?php
$this->headTitle(' - The very latest in film & movie news, taken from the most popular sources', 'SET');
$this->headScript()
        ->appendFile('js/featured.js')
        ;

$this->headMeta()->appendName('description', "Articles on the greatest films ever made, and the very latest news on today's movie industry.");
?>
<script type='text/javascript'>
    var changeSlide = new AutoChangeSlide({
        maxSlides : <?php echo isset($this->articles->featuredArticles)?count($this->articles->featuredArticles):0; ?>,
        startSlide : 1,
        element : $('div#featuredArticles article')
    });
    
    $(function() {
        changeSlide.firstSlide();
        var intervalId = changeSlide.setupTiming();
        
        $('div#featured nav img').click(function() {
            window.clearInterval(intervalId);
            var articleId = $(this).attr('value');
            $('div#featured div#featuredArticles article').hide();
            $('div#featured div#featuredArticles article').each(function() {
                if ($(this).attr('value') === articleId) {
                    $(this).show();
                }
            });
            intervalId = changeSlide.setupTiming();
        });
        
        $('div#featuredArticles article h3 a').click(function(event) {
            event.preventDefault();
        });
        
        $('div#articlesContent article').click(function() {
            window.location.href = $(this).find('a').attr('href');
        });
        
        $.ajax({
            url: '<?php echo $this->url('youtube'); ?>',
        }).done(function(data) {
            var html = ''
            for (var n=0; n<data.videos.items.length; n++) {
                var item = data.videos.items[n];
                console.log(item);
                if (item.id.videoId) {
                    html += '<img src="' 
                        + item.snippet.thumbnails.medium.url
                        + '">';
                }
            }
            $('#youtube section').append(html);
        });
        
    });
    
</script>


<?php //$this->headStyle()->captureStart(); ?>
<style>
    
    /* Featured Content */
    
    div#featured {
        float: left;
        width: 596pt;
        background-color: #e0e0e0;
        padding: 5pt;
        margin: 0pt 0pt 0pt 10pt;
    }
    
    div#featuredContent {
        border-left: 2pt solid #fff;
        border-right: 2pt solid #fff;
        padding: 2pt 10pt;
    }
    
    div#featuredArticles {
        float: left;
/*        border: 1pt solid #000;*/
        margin: 0pt 0pt 0pt 10pt;
        height: 230pt;
    }
    
    div#featuredArticles article {
        /*display: none;*/
        width: 500pt;
    }
    
    div#featuredArticles article div.image {
        width: 500pt;
        height: 230pt;
        overflow: hidden;
    }
    
    div#featuredArticles article div.image img {
        width: 100%;
    }
    
    div#featured article section {
        background-color: rgba(0,0,0, 0.7);
        position: relative;
        top: -85pt;
        height: 65pt;
        width: 440pt;
        padding: 10pt 50pt 10pt 10pt;
        color: #fff;
    }

    div#featured article section h3 {
        font-size: 0.8em;
        font-weight: bold;
        margin: 2pt 0pt 4pt;        
    }
    
    div#featured article section h3 a {
        color: #fff;
        text-decoration: none;
    }
    
    div#featured article section p {
        font-size: 0.7em;
    }

    div#featured article section p.subtitle {
        margin: 2pt 0pt 4pt;
        font-weight: bold;
    }
    
    div#featuredContent nav {
        float: left;
    }
    
    div#featuredContent nav div.nav {
        width: 60pt;
        height: 36pt;
        margin: 2pt 0pt;
        overflow: hidden;
    }
    
    div#featuredContent nav div.nav img {
        width: 100%;
    }
    
    /* Youtube */
    div#youtube {
        float: right;
        width: 171pt;
        padding: 5pt;
        margin: 0pt 0pt 0pt;
    }
    
    div#youtube section {
        border-left: 2pt solid #e0e0e0;
        border-right: 2pt solid #e0e0e0;
        padding: 2pt 10pt;
    }
    
    div#youtube section div {
        background-color: #d3222a;
        padding: 0 35pt;
        margin-bottom: 10pt;
    }
    
    div#youtube section img {
        width: 100%;
    }
    
    div#youtube section div img {
        width: 75pt;
    }
    
    /* Features */
    div#articles {
        clear: left;
        float: left;
        width: 596pt;
        padding: 5pt;
        margin: 10pt 0pt 0pt 10pt;
    }
    
    div#articlesContent {
        border-left: 2pt solid #e0e0e0;
        border-right: 2pt solid #e0e0e0;
        padding: 2pt 10pt;
    }
    
    /* Articles */
    
    div#articles h2, div#youtube h2 {
        background-color: #d3222a;
        padding: 10pt;
        color: #fff;
        margin: 5pt 0pt 10pt;
        font-weight: bold;
        font-size: 0.85em;
    }
    
    div#articles article {
        clear: both;
        padding: 5pt 10pt;
        cursor: pointer;
    }
    
    div#articles article:hover {
        background-color: #e0e0e0;
    }
    
    div#articles article h3 {
        font-size: 0.85em;
        font-weight: bold;
    }
    div#articles article p {
        margin: 5pt 0pt;
        font-size: 0.75em;
    }
    div#articles article h3 a {
        color: inherit;
        text-decoration: none;
    }
    
    div#articles article div.image {
        width: 100pt;
        height: 60pt;
        float: left;
        margin: 0pt 10pt 0pt 0pt;
        overflow: hidden;
    }
    
    div#articles article div.image img {
        width: 100%;
    }
    
    div#articles article p.date {
        font-weight: bold;
    }
    
</style>
<?php //$this->headStyle()->captureEnd(); ?>
<?php if (isset($this->articles->featuredArticles) && count($this->articles->featuredArticles) > 0): ?>
<div id='featured'>
    <div id="featuredContent">
        <nav>
            <?php $imageCount = 1; ?>
            <?php foreach ($this->articles->featuredArticles as $featuredArticle): ?>
                <?php $image = current($featuredArticle->articleImages); ?>
            <div class="nav">
                <img src="<?php echo $image->url; ?>" value='<?php echo $imageCount; ?>' />
            </div>
                <?php $imageCount++; ?>
            <?php endforeach; ?>
        </nav>
        <div id='featuredArticles'>
            <?php $count = 1; ?>
            <?php foreach ($this->articles->featuredArticles as $featuredArticle): ?>
            <article value='<?php echo $count; ?>'>
                <?php $image = current($featuredArticle->articleImages); ?>
                <div class="image">
                    <img src="<?php echo $image->url; ?>" />
                </div>
                <section>
                    <h3><a href="<?php echo $this->url('article/profile', array('slug' => $featuredArticle->slug)); ?>"><?php echo $featuredArticle->title; ?></a></h3>
                    <p class="subtitle"><?php echo $featuredArticle->subtitle; ?></p>
                    <p><?php echo $featuredArticle->summary; ?>...</p>
                </section>
            </article>
            <?php $count++; ?>
            <?php endforeach; ?>
        </div>
        <div style='clear: both'></div>
    </div>
</div>
<?php endif; ?>
<div id="youtube">
    <section>
        <div><img src='<?php echo $this->basePath('images/YouTube-logo-light.png'); ?>'></div>
    </section>
</div>

<div id='articles'>
    <div id="articlesContent">
        
        <div id='features'>
            <h2>Features</h2>
            <?php foreach ($this->articles->features as $article): ?>
            <article>
                <?php if (count($article->articleImages) > 0): ?>
                <div class='image'>
                    <img src="<?php echo current($article->articleImages)->url; ?>" style=""/>
                </div>
                <?php endif; ?>
                <h3><a href="<?php echo $this->url('article/profile', array('slug' => $article->slug));?>"><?php echo strip_tags($article->title); ?></a></h3>
                <p><?php echo trim($article->summary); ?>...</p>
                <p class="date">Date: <?php echo $this->DisplayDate($article->publishDate); ?></p>
                <div style='clear: both;'></div>
            </article>
            <?php endforeach; ?>
            
        </div>
        
        <div id='news'>
            <h2>News</h2>
            <?php foreach ($this->articles->news as $article): ?>
            <article>
                <?php if (count($article->articleImages) > 0): ?>
                <div class='image'>
                    <img src="<?php echo current($article->articleImages)->url; ?>" style=""/>
                </div>
                <?php endif; ?>
                <h3><a href="<?php echo $this->url('article/profile', array('slug' => $article->slug));?>"><?php echo strip_tags($article->title); ?></a></h3>
                <p><?php echo trim($article->summary); ?>...</p>
                <p class="date">Date: <?php echo $this->DisplayDate($article->publishDate); ?></p>
                <div style='clear: both;'></div>
            </article>
            <?php endforeach; ?>
            <div style='clear: both;'></div>
        </div>
    </div>
</div>